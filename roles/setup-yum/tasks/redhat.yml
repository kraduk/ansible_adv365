---

#  - name: fix rhn proxy
#    action: lineinfile 
#      regexp="^httpProxy=http://127.0.0.1:{{proxy}}" 
#      line="httpProxy=http://127.0.0.1:{{proxy}}" 
#      dest=/etc/sysconfig/rhn/up2date 
#      state=present
#    when: ansible_distribution | lower == 'redhat'
#    tags:
#      - proxy
#      - rhn_reg
#
#  - name: turn on rhn proxy
#    action: lineinfile 
#      regexp="^enableProxy=0" 
#      line="enableProxy=1" 
#      dest=/etc/sysconfig/rhn/up2date 
#      state=present
#    when: ansible_distribution | lower == 'redhat'
#    tags:
#      - proxy
#      - rhn_reg
#
  - name: turn on proxy
    shell: "{{sub_comm}}"
    tags: rhn_prox

# RHEL 7 no longer supports RHN Classic subscription via rhn_register so subscription manager is used
  - name: Register & subscribe RHEL 
    action: redhat_subscription
     state=present 
     username=webabacus-webap-01 
     password=h0lycr4p! 
     autosubscribe=true
    environment:
      http_proxy: http://127.0.0.1:{{proxy}}
